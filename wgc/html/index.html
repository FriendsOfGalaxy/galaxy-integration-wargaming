<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/style.css">
    <title>Connect with Wargaming.net</title>
</head>

<body>
    <div class="container">
        <div class="content">
            <header class="main-header">
                <div class="main-header__container">
                    <img class="wargaming-logo-icon" src="img/icon-wargaming-logo.svg" alt="Steam logo">
                    <div class="main-header__title">
                        <h1 class="title">Connect with Wargaming.net</h1>
                        <p class="subtitle">To an existing Wargaming.net account</p>
                    </div>
                </div>
                <div class="main-header__container padlock-icon-container">
                    <svg class="padlock-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15">
                        <g fill-rule="evenodd">
                            <path d="M7.5 0c2 0 3.5 1.6 3.5 3.5V5h1a2 2 0 012 2v6a2 2 0 01-2 2H3a2 2 0 01-2-2V7c0-1.1.9-2 2-2h1V3.5C4 1.5 5.6 0 7.5 0zm0 8c-.2 0-.4.2-.5.4v3.1a.5.5 0 001 0v-3c0-.3-.2-.5-.5-.5zm0-7C6.2 1 5.1 2 5 3.3V5h5V3.5C10 2.2 9 1.1 7.7 1h-.2z"/>
                        </g>
                    </svg>
                    <span class="tooltip">GOG Galaxy does not hold your data. Your login and password will be sent as encrypted data to Wargaming.net servers.</span>
                </div>
            </header>
            
            <section class="main-content">
                <form id="main-form" class="main-form" action="/login" method="POST">
                    
                    <fieldset id="loginFieldset" style="display: none;">
                        <legend>Login with your Wargaming.net account below to access your Wargaming.net games and friends from GOG Galaxy.</legend>
                        <div class="field-group">
                            <label for="step-1-realm">Realm</label>
                            <select class="basic-input login-input" id="step-1-realm" name="realm" disabled="disabled">
                                <option>RU</option>
                                <option>EU</option>
                                <option>NA</option>
                                <option>ASIA</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label for="step-1-email">Wargaming.net email</label>
                            <input class="basic-input login-input" type="email" id="step-1-email" name="email" disabled="disabled" placeholder="name@example.com">
                        </div>
                        <div class="field-group">
                            <label for="step-1-password">Password</label>
                            <input class="basic-input login-input" type="password" id="step-1-password" name="password" disabled="disabled">
                        </div>

                    </fieldset>
                    
                    <fieldset id="loginErrorFieldset" style="display: none;">
                        <legend>Login with your Wargaming.net account below to access your Wargaming.net games and friends from GOG Galaxy.</legend>
                        <div class="field-group">
                            <label for="step-2-realm">Realm</label>
                            <select class="basic-input login-input" id="step-2-realm" name="realm" disabled="disabled">
                                <option>RU</option>
                                <option>EU</option>
                                <option>NA</option>
                                <option>ASIA</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label for="step-2-email">Steam email</label>
                            <input class="basic-input login-input errored" type="email" id="step-2-email" name="email" disabled="disabled" placeholder="name@example.com">
                        </div>
                        <div class="field-group relative">
                            <label for="step-2-password-errored">Password</label>
                            <input class="basic-input login-input errored" type="password" id="step-2-password-errored" name="password" disabled="disabled">
                            <div class="show-password"></div>
                        </div>
                        <p class="error-message">
                            <img src="img/icon-error.svg" alt="" class="error-icon"> You have entered your password or account name incorrectly. Please check your password and account name and try again.
                        </p>
                    </fieldset>

                    <fieldset id="twoFactorFieldset" style="display: none;">
                        <legend>As an additional security measure, you’ll need to enter the current code from the Authenticator.</legend>
                        <div class="field-group field-group--no-justify">
                            <label for="step-3-code">Authenticator code</label>
                            <input class="basic-input two-factor-input" type="text" id="step-3-authcode" name="authcode" disabled="disabled" placeholder="123456">
                        </div>
                        <div class="field-group field-group--no-justify">
                            <input type="checkbox" class="basic-input" name="use_backup" id="step-3-usebackup">
                            <label for="step-3-usebackup">Use backup code instead of one-time password</label>
                        </div>
                    </fieldset>

                    <fieldset id="twoFactorErrorFieldset" style="display: none;">
                        <legend>As an additional security measure, you’ll need to enter the current code from the Authenticator.</legend>
                        <p class="error-message error-message--centered">
                            <img src="img/icon-error.svg" alt="" class="error-icon"> Invalid code
                        </p>
                        <div class="field-group field-group--no-justify">
                            <label for="step-4-code">Authenticator code</label>
                            <input class="basic-input two-factor-input errored" type="text" id="step-4-authcode" name="authcode" disabled="disabled" placeholder="123456">
                        </div>

                        <div class="field-group field-group--no-justify">
                            <input type="checkbox" class="basic-input" name="use_backup" id="step-4-usebackup">
                            <label for="step-4-usebackup">Use backup code instead of one-time password</label>
                        </div>
                    </fieldset>
                </form>
            </section>
            <footer class="main-footer">
                <div class="main-footer__container"></div>
                <div class="main-footer__container">
                    <button class="basic-button main-footer__button main-footer__button--primary" type="submit" form="main-form">Continue</button>
                </div>
            </footer>
        </div>
    </div>
    <script>
        // Toggling password visibility

        const toggleButton = document.querySelector(".show-password");
        const input = document.getElementById("step-2-password-errored");
        function togglePasswordVisibility() {
            if (input.type === "password") {
                input.type = "text";
            } else {
                input.type = "password"
            }
        }
        toggleButton.addEventListener("click", togglePasswordVisibility);

        // Handling urlParams, form actions and enabling inputs

        const urlParamsObj = {
            login: "?view=login",
            loginErrored: "?view=login&errored=true",
            twoFactor: "?view=twoFactor",
            twoFactorErrored: "?view=twoFactor&errored=true"
        };

        const fieldSetsObj = {

            loginFieldSet: document.querySelector("#loginFieldset"),
            loginInputs: document.querySelectorAll("#loginFieldset input, #loginFieldset select"),

            loginErrorFieldset: document.querySelector("#loginErrorFieldset"),
            loginErroredInputs: document.querySelectorAll("#loginErrorFieldset input, #loginErrorFieldset select"),

            twoFactorFieldset: document.querySelector("#twoFactorFieldset"),
            twoFactorInputs: document.querySelectorAll("#twoFactorFieldset input"),

            twoFactorErrorFieldset: document.querySelector("#twoFactorErrorFieldset"),
            twoFactorErrorInputs: document.querySelectorAll("#twoFactorErrorFieldset input")

        }

        function handleEnablingInputs(inputs) {
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].disabled = false;   
            }
        }

        function handleParamsAndFormAction() {
            const url = window.location.search;
            const formElement = document.querySelector("#main-form");
            const forgotPasswordButtonElement = document.querySelector(".forgot-password");

            switch (url) {
                //login
                case urlParamsObj.login:
                    fieldSetsObj.loginFieldSet.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.loginInputs);
                    forgotPasswordButtonElement.style.display = "block";
                    formElement.action = "/login";
                    break;
                case urlParamsObj.loginErrored:
                    fieldSetsObj.loginErrorFieldset.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.loginErroredInputs);
                    forgotPasswordButtonElement.style.display = "block";
                    formElement.action = "/login";
                    break;
                
                //2FA
                case urlParamsObj.twoFactor:
                    fieldSetsObj.twoFactorFieldset.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.twoFactorInputs);
                    formElement.action = "/twoFactor";
                    break;
                    
                case urlParamsObj.twoFactorErrored:
                    fieldSetsObj.twoFactorErrorFieldset.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.twoFactorErrorInputs);
                    formElement.action = "/twoFactor";
                    break;
            }
        }
        window.addEventListener("load", handleParamsAndFormAction);
    </script>
</body>

</html>
